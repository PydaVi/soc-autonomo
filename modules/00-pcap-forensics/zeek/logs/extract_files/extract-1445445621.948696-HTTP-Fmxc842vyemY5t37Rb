function checkSubmit(form)
{
	var i;
	var offset=1;
	var cnt=parseInt(form.rules.value);
	for(i=0 ; i<cnt ; i++){
		if(!checkIPMask(form.elements[offset+6*i+2]))
			return false;
		if(!checkPort(form.elements[offset+6*i+3]))
			return false;
	}
	return true;
}
function checkSpace(str)
{
	var rTok = / /g;
	var ret = str.search(rTok);
	if(ret>=0)
		return false;
	return true;
}

function checkPort(comp)
{
	if(!checkSpace(comp.value)){
		alert("Invalid [Port].");
		comp.select();
		return false;
	}
	var myArray=comp.value.split(':');
	var cnt=myArray.length;
	if(cnt==1){
		var port=0;
		if(myArray[0].length==0 || isNaN(myArray[0]))
			port=0;
		else
			port=parseInt(myArray[0]);
		if(port<=0){
			alert("Invalid [Port].");
			comp.select();
			return false;
		}
	}else if(cnt==2){
		var port0=0;
		var port1=0;
		if(myArray[0].length==0 || isNaN(myArray[0])) port0=0;
		else port0=parseInt(myArray[0]);
		if(myArray[1].length==0 || isNaN(myArray[1])) port1=0;
		else port1=parseInt(myArray[1]);
		if(port0<=0||port1<=0){
			alert("Invalid [Port].");
			comp.select();
			return false;
		}
		if(port0>=port1){
			alert("Invalid [Port].");
			comp.select();
			return false;
		}
	}else{
		alert("Invalid [Port].");
		comp.select();
		return false;
	}
	return true;
}

function checkIPMask(comp)
{
	if(!checkSpace(comp.value)){
		alert("Invalid IP address of [IP address/Mask].");
		comp.select();
		return false;
	}
	var myArray=comp.value.split('/');
	var cnt=myArray.length;
	if(cnt==2){
		if(!checkIP(myArray[0])){
			alert("Invalid IP address of [IP address/Mask].");
			comp.select();
			return false;
		}
		if(!checkMask(myArray[1])){
			alert("Invalid mask of [IP address/Mask].");
			comp.select();
			return false;
		}
	}else{
		alert("Invalid [IP address/Mask].");
		comp.select();
		return false;
	}
	return true;
}

function checkIP(ip)
{
	if(ip.search(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/) != -1){
		var myArray = ip.split(/\./);
		if(myArray[0] > 255 || myArray[1] > 255 || myArray[2] > 255 || myArray[3] > 255)
			return false;
		if(myArray[0] == 255 && myArray[1] == 255 && myArray[2] == 255 && myArray[3] == 255)
			return false;
	}else
		return false;
	
	return true;
}
  
function checkMask(mask)
{
	if(mask.search(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/) != -1){
		var myArray = mask.split(/\./);
		if(myArray[0] > 255 || myArray[1] > 255 || myArray[2] > 255 || myArray[3] > 255)
			return false;
	}else
		return false;
	
	return true;
}

function checkAdd()
{
	var form=document.configure;
	var formA=document.add;
	if(!checkIPMask(form.ipmask)) return;
	if(!checkPort(form.port)) return;
	formA.mode.value=2;
	formA.iface.value=form.iface.value;
	formA.bipopt.value=form.bipopt.value;
	formA.ipmask.value=form.ipmask.value;
	formA.port.value=form.port.value;
	formA.target.value=form.target.value;
	formA.submit();
}

function checkRemove(iface,bipopt,ipmask,port,target)
{
	var formR=document.add;//remove->add
	formR.mode.value=3;
	formR.iface.value=iface;
	formR.bipopt.value=bipopt;
	formR.ipmask.value=ipmask;
	formR.port.value=port;
	formR.target.value=target;
	formR.submit();
}

function checkTelnet(toAdd)
{
	var formE=document.add;
	if(toAdd==1){
		formE.mode.value=2;
	}else{
		formE.mode.value=3;
	}
	formE.iface.value="all";
	formE.bipopt.value=0;
	formE.ipmask.value="0.0.0.0/0.0.0.0";
	formE.port.value="23";
	formE.target.value="DROP";
	formE.submit();
}

function checkSSH(toAdd)
{
	var formE=document.add;
	if(toAdd==1){
		formE.mode.value=2;
	}else{
		formE.mode.value=3;
	}
	formE.iface.value="all";
	formE.bipopt.value=0;
	formE.ipmask.value="0.0.0.0/0.0.0.0";
	formE.port.value="22";
	formE.target.value="DROP";
	formE.submit();
}

function checkWeb(toAdd)
{
	var formE=document.add;
	if(toAdd==1){
		formE.mode.value=4;
	}else{
		formE.mode.value=5;
	}
	formE.submit();
}
